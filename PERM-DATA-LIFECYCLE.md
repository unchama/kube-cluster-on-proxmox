# くばねてすクラスタ上に配置される永続データについて

## 永続データに課される要件

- 1次保管・利用のストレージ機器上において
  - 指定した時間にデータ領域全体の静止点を確保できること
    - この作業はほぼ無停止で実施可能であることが望ましい(やっても対象永続データの操作を行っている対象ソフトウェアの一時停止程度)
  - 任意のタイミングで取得した静止点にデータを戻せること
    - この作業は可能な限り短時間で実施可能であることが望ましい
- 1次保管・利用のストレージ機器とは別に、別のストレージ機器に対してバックアップを保管すること(2次保管)
  - 2次保管領域へのバックアップは
    - ある程度時間がかかっても構わない
    - が、特定タイミングの静止点を確保でき、かつバックアップ中サーバーは無停止であること
  - 2次保管領域からのリストアは
    - ある程度時間がかかっても構わない
    - リストア中サーバーの停止を伴って構わない
- 上記に加えて、1次保管・利用のストレージ機器上において
  - くばねてすクラスターのライフサイクルを超えて、ダイナミックプロビジョンした1次ボリュームをマッピングできる仕組みがあると嬉しい
    - 要は、クラスター再構築時などにより内部の構成データが吹っ飛んだ際に、吹っ飛ぶ前に使用していたボリュームを再マップできる仕組みがあると嬉しい
    - なぜなら、くばねてすクラスターの再構築は十分想定されうる作業であり、その際に毎回長時間かかることが想定される2次保管領域からのリストアを実施するのは非現実的であるから

## 要件をどう満たすか

- velero
  - volumesnapshot
    - 1次保管・利用のストレージ機器上におけるスナップショットおよびリストアに使用
    - クラスター吹っ飛んだ時のボリューム再マップをどうするか…
      - クラスター構成情報は外部に保管しておいて、クラスター再構築後に戻したいなー
  - restic backup
    - 2次保管ストレージ機器へのバックアップおよびリストアに使用
